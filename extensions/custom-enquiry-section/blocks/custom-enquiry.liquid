{% comment %}
  Custom Enquiry Block
  Renders a customizable enquiry form with localized copy and optional product context.
  Ensure corresponding translation entries exist in locales.
{% endcomment %}
{% liquid
  assign show_intro_text = block.settings.show_intro_text
  assign product_handle_param = 'product_handle'
  assign show_product_context = true
  assign preview_product = block.settings.preview_product
  assign preview_product_json = nil
  assign banner_image = block.settings.banner_image
  assign banner_image_url = ''
  assign header_image_size = block.settings.header_image_size | default: 120
  assign heading_size = block.settings.heading_size | default: 28
  assign button_text = block.settings.button_text
  assign button_color_scheme = block.settings.button_color_scheme | default: 'primary'
  assign button_bg = block.settings.button_background_color
  assign button_text_color = block.settings.button_text_color
  if button_text == blank
    assign button_label = 'sections.custom_enquiry.submit' | t
  else
    assign button_label = button_text
  endif
  if banner_image != blank
    assign banner_image_url = banner_image | image_url: width: 1200
  else
    assign banner_image_url = 'https://images.unsplash.com/photo-1545239351-1141bd82e8a6?auto=format&fit=crop&w=1200&q=80'
  endif
  if request.design_mode and preview_product != blank
    assign preview_product_json = preview_product | json
  endif
%}
{{ 'custom-enquiry.css' | asset_url | stylesheet_tag }}
{{ 'custom-enquiry.js' | asset_url | script_tag }}

<section
  class="custom-enquiry"
  id="custom-enquiry-{{ block.id }}"
  style="--header-image-size: {{ header_image_size }}px; --heading-font-size: {{ heading_size }}px;{% if button_bg != blank %} --button-bg: {{ button_bg }};{% endif %}{% if button_text_color != blank %} --button-text: {{ button_text_color }};{% endif %}"
  {{ block.shopify_attributes }}
>
  <div
    class="custom-enquiry__inner"
    {% if show_product_context %}
      data-product-context-wrapper
    {% endif %}
  >
    <script type="application/json" data-title-templates>
      {
        "visual": {{ 'sections.custom_enquiry.titles.visual' | t | json }},
        "visual_with_product": {{ 'sections.custom_enquiry.titles.visual_with_product' | t | json }},
        "quote": {{ 'sections.custom_enquiry.titles.quote' | t | json }},
        "quote_with_product": {{ 'sections.custom_enquiry.titles.quote_with_product' | t | json }},
        "sample": {{ 'sections.custom_enquiry.titles.sample' | t | json }},
        "sample_with_product": {{ 'sections.custom_enquiry.titles.sample_with_product' | t | json }},
        "buy": {{ 'sections.custom_enquiry.titles.buy' | t | json }},
        "buy_with_product": {{ 'sections.custom_enquiry.titles.buy_with_product' | t | json }}
      }
    </script>
    <header class="custom-enquiry__header">
      {% if show_product_context %}
        <div
          class="custom-enquiry__product-context"
          data-product-context
          data-product-handle-param="{{ product_handle_param | escape }}"
          data-shop-currency="{{ shop.currency }}"
          data-locale="{{ request.locale.iso_code | default: shop.locale }}"
        >
          <div class="custom-enquiry__header-media" data-product-card hidden aria-hidden="true">
            <img
              class="custom-enquiry__header-image"
              data-product-image
              alt=""
              width="{{ header_image_size }}"
              height="{{ header_image_size }}"
              loading="lazy"
            >
          </div>
          {% if preview_product_json %}
            <script type="application/json" data-preview-product>
              {{ preview_product_json }}
            </script>
          {% endif %}
        </div>
      {% endif %}
      <h1 class="custom-enquiry__heading" data-dynamic-heading>
        {{ 'sections.custom_enquiry.title' | t }}
      </h1>
    </header>
    {% if show_intro_text and block.settings.intro_text != blank %}
      <div class="custom-enquiry__intro rte">
        {{ block.settings.intro_text }}
      </div>
    {% endif %}
    <p class="custom-enquiry__subheading">
      {{ 'sections.custom_enquiry.subtitle' | t }}
    </p>

    <div class="custom-enquiry__layout">
      <div class="custom-enquiry__form-wrapper">
        <form
          class="custom-enquiry__form js-custom-request-form"
          method="post"
          action="{{ routes.root_url }}apps/enquiry"
          data-proxy-url="{{ routes.root_url }}apps/enquiry"
          data-success-message="{{ 'sections.custom_enquiry.status.success' | t }}"
          data-error-message="{{ 'sections.custom_enquiry.status.error' | t }}"
          enctype="multipart/form-data"
          novalidate
        >
          <div class="custom-enquiry__status" aria-live="polite" role="status"></div>
          <input type="hidden" name="block_id" value="{{ block.id }}">
          <input type="hidden" name="request_type" value="visual_enquiry" data-request-type-input>
          {% if show_product_context %}
            <input type="hidden" name="product_id" data-product-id-input>
            <input type="hidden" name="product_handle" data-product-handle-input>
            <input type="hidden" name="product_title" data-product-title-input>
            <input type="hidden" name="product_url" data-product-url-input>
          {% endif %}

          <fieldset class="custom-enquiry__fieldset">
            <legend class="custom-enquiry__legend">
              {{ 'sections.custom_enquiry.groups.request.title' | t }}
            </legend>
            <p class="custom-enquiry__fieldset-description">
              {{ 'sections.custom_enquiry.groups.request.description' | t }}
            </p>
            <div class="custom-enquiry__grid">
              <div class="custom-enquiry__field">
                <label class="custom-enquiry__label" for="custom-enquiry-name-{{ block.id }}">
                  {{ 'sections.custom_enquiry.fields.name' | t }}
                </label>
                <input
                  id="custom-enquiry-name-{{ block.id }}"
                  class="custom-enquiry__input"
                  type="text"
                  name="name"
                  autocomplete="name"
                  required
                >
              </div>
              <div class="custom-enquiry__field">
                <label class="custom-enquiry__label" for="custom-enquiry-company-{{ block.id }}">
                  {{ 'sections.custom_enquiry.fields.company_name' | t }}
                </label>
                <input
                  id="custom-enquiry-company-{{ block.id }}"
                  class="custom-enquiry__input"
                  type="text"
                  name="company_name"
                  autocomplete="organization"
                  required
                >
              </div>
              <div class="custom-enquiry__field">
                <label class="custom-enquiry__label" for="custom-enquiry-phone-{{ block.id }}">
                  {{ 'sections.custom_enquiry.fields.phone_number' | t }}
                </label>
                <input
                  id="custom-enquiry-phone-{{ block.id }}"
                  class="custom-enquiry__input"
                  type="tel"
                  name="phone_number"
                  autocomplete="tel"
                  required
                  inputmode="tel"
                >
              </div>
              <div class="custom-enquiry__field">
                <label class="custom-enquiry__label" for="custom-enquiry-email-{{ block.id }}">
                  {{ 'sections.custom_enquiry.fields.email' | t }}
                </label>
                <input
                  id="custom-enquiry-email-{{ block.id }}"
                  class="custom-enquiry__input"
                  type="email"
                  name="email"
                  autocomplete="email"
                  required
                  inputmode="email"
                >
              </div>
              <div class="custom-enquiry__field">
                <label class="custom-enquiry__label" for="custom-enquiry-quantity-{{ block.id }}">
                  {{ 'sections.custom_enquiry.fields.quantity' | t }}
                </label>
                <input
                  id="custom-enquiry-quantity-{{ block.id }}"
                  class="custom-enquiry__input"
                  type="number"
                  min="1"
                  step="1"
                  name="quantity"
                  inputmode="numeric"
                  required
                >
              </div>
              <div class="custom-enquiry__field">
                <label class="custom-enquiry__label" for="custom-enquiry-deadline-{{ block.id }}">
                  {{ 'sections.custom_enquiry.fields.delivery_deadline' | t }}
                </label>
                <input
                  id="custom-enquiry-deadline-{{ block.id }}"
                  class="custom-enquiry__input"
                  type="date"
                  name="delivery_deadline"
                  required
                >
              </div>
              <div class="custom-enquiry__field custom-enquiry__field--span-2">
                <label class="custom-enquiry__label" for="custom-enquiry-worked-before-{{ block.id }}">
                  {{ 'sections.custom_enquiry.fields.worked_with_before.label' | t }}
                </label>
                <select
                  id="custom-enquiry-worked-before-{{ block.id }}"
                  class="custom-enquiry__select"
                  name="worked_with_before"
                  required
                >
                  <option value="">
                    {{ 'sections.custom_enquiry.fields.worked_with_before.placeholder' | t }}
                  </option>
                  <option value="no">
                    {{ 'sections.custom_enquiry.fields.worked_with_before.options.no' | t }}
                  </option>
                  <option value="yes">
                    {{ 'sections.custom_enquiry.fields.worked_with_before.options.yes' | t }}
                  </option>
                  <option value="not_sure">
                    {{ 'sections.custom_enquiry.fields.worked_with_before.options.not_sure' | t }}
                  </option>
                </select>
              </div>
              <div class="custom-enquiry__field custom-enquiry__field--span-2">
                <label class="custom-enquiry__label" for="custom-enquiry-attachment-{{ block.id }}">
                  {{ 'sections.custom_enquiry.fields.attachment' | t }}
                </label>
                <input
                  id="custom-enquiry-attachment-{{ block.id }}"
                  class="custom-enquiry__input custom-enquiry__input--file"
                  type="file"
                  name="attachment"
                >
                <p class="custom-enquiry__field-hint">
                  {{ 'sections.custom_enquiry.fields.attachment_hint' | t }}
                </p>
              </div>
              <div class="custom-enquiry__field custom-enquiry__field--span-2">
                <label class="custom-enquiry__label" for="custom-enquiry-other-{{ block.id }}">
                  {{ 'sections.custom_enquiry.fields.other_requirements' | t }}
                </label>
                <textarea
                  id="custom-enquiry-other-{{ block.id }}"
                  class="custom-enquiry__textarea"
                  name="other_requirements"
                  rows="5"
                  placeholder="{{ 'sections.custom_enquiry.fields.other_requirements_placeholder' | t }}"
                ></textarea>
              </div>
            </div>
          </fieldset>

          <div class="custom-enquiry__actions">
            <button class="custom-enquiry__submit custom-enquiry__submit--{{ button_color_scheme }}" type="submit">
              {{ button_label }}
            </button>
            <p class="custom-enquiry__disclaimer">
              {{ 'sections.custom_enquiry.disclaimer' | t }}
            </p>
          </div>
        </form>
      </div>
      <aside class="custom-enquiry__banner" aria-hidden="true">
        <img
          class="custom-enquiry__banner-image"
          src="{{ banner_image_url | escape }}"
          alt=""
          loading="lazy"
        >
      </aside>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Custom enquiry",
  "target": "section",
  "settings": [
    {
      "type": "header",
      "content": "Header appearance"
    },
    {
      "type": "range",
      "id": "header_image_size",
      "min": 64,
      "max": 200,
      "step": 8,
      "default": 120,
      "unit": "px",
      "label": "Header product image size",
      "info": "Diameter of the circular product image next to the title."
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 18,
      "max": 48,
      "step": 2,
      "default": 28,
      "unit": "px",
      "label": "Heading size",
      "info": "Font size of the main title (e.g. Instant Quote forâ€¦)."
    },
    {
      "type": "richtext",
      "id": "intro_text",
      "label": "Introductory rich text",
      "default": "<p>Share additional context for this enquiry form.</p>"
    },
    {
      "type": "checkbox",
      "id": "show_intro_text",
      "label": "Show intro text",
      "default": false
    },
    {
      "type": "image_picker",
      "id": "banner_image",
      "label": "Banner image",
      "info": "Portrait-oriented image shown alongside the enquiry form."
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Send enquiry",
      "info": "Leave blank to use the default translation."
    },
    {
      "type": "select",
      "id": "button_color_scheme",
      "label": "Button style",
      "options": [
        { "value": "primary", "label": "Primary (dark)" },
        { "value": "secondary", "label": "Secondary (outline)" },
        { "value": "accent", "label": "Accent" }
      ],
      "default": "primary"
    },
    {
      "type": "color",
      "id": "button_background_color",
      "label": "Button background color",
      "info": "Leave blank to use the style default."
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "info": "Leave blank to use the style default."
    },
    {
      "type": "header",
      "content": "Product context"
    },
    {
      "type": "product",
      "id": "preview_product",
      "label": "Preview product for theme editor",
      "info": "Shown in the theme editor when no URL parameter is present."
    }
  ]
}
{% endschema %}


